---
title: СибирьОС 3.0 - техническая документация системы
date: 2025-05-12
category: СибирьОС
layout: post
cover: /assets/img/1.png
---

## Описание системы

**LindaOS** — мини-операционная система для Arduino с цветным TFT-дисплеем и сенсорным экраном. Реализует графический интерфейс с несколькими приложениями, такими как:

- Главный экран с кнопками запуска приложений  
- Рисовалка (paint)  
- Просмотр метеоданных (meteo)  
- Настройки экрана и системы  
- Система паролей с защитой доступа  
- Сенсорное управление и ввод через экранную клавиатуру  
- Сохранение настроек в EEPROM  
- Поддержка датчиков: DHT11, фотосенсор, датчик влажности почвы, RTC DS1302

----

## Аппаратное обеспечение

| Компонент                     | Описание                      | Подключение / Пины               |
|----------------------------------------|-----------------------------------------|--------------------------------------------|
| Arduino MCU                  | Основной контроллер           | —                               |
| TFT-дисплей (MCUFRIEND_kbv)  | Цветной TFT с сенсорным экраном | SPI + цифровые пины              |
| Сенсорный экран TouchScreen   | Сенсорный ввод                | XP=8, XM=A2, YP=A3, YM=9        |
| DHT11                        | Датчик температуры и влажности | Пин 18                          |
| DS1302                       | Часы реального времени         | CLK=34, DAT=36, RST=38           |
| Фоторезистор                 | Измерение освещённости         | A9                              |
| Датчик влажности почвы       | Аналоговый датчик влажности    | A8                              |
| Датчик воды                  | Аналоговый датчик воды         | A11                             |
| EEPROM                       | Встроенная энергонезависимая память | Используется для хранения настроек |

----

## Используемые библиотеки

- `<EEPROM.h>` — работа с энергонезависимой памятью  
- `<MCUFRIEND_kbv.h>` — управление TFT-дисплеем  
- `<GyverTimers.h>` — управление таймерами  
- `<TouchScreen.h>` — сенсорный экран  
- `<Adafruit_GFX.h>` — графические функции TFT  
- `TimesNRCyr10.h` — кириллический шрифт для TFT  
- `<dht11.h>` — датчик DHT11  
- `<DS1302.h>` — часы реального времени DS1302

----

## Структура проекта и архитектура

### Настройки системы (struct sys_data)

```c++
struct {
  char deviceLogo[24] = "  LindaOS";
  byte rotate = 1;          // Поворот экрана (0..3)
  bool usePassword = false; // Включён ли пароль
  byte password[16];        // Массив для пароля (255 — пустой)
} sys_data;
```
-    Настройки хранятся в EEPROM с ключом ByteKey = 12 в первом байте

-    При загрузке проверяется ключ, если не совпадает — настройки сбрасываются

## Инициализация системы

-    `initSystem()` — инициализация TFT, сенсора, загрузка настроек из EEPROM, установка шрифтов

-    `cryptoInitSystem()` — альтернативная инициализация с разными параметрами Serial и TFT

## Сенсорный ввод

Пины сенсорного экрана:

|Пин	|Назначение|
|:-:|:-:|
|8	|XP|
|A2	|XM|
|A3	|YP|
|9	|YM|

### Функции:

- `readTouch_()` — чтение координат касания

-  `waitForTouch()` — ожидание касания экрана

## Пароль и безопасность

-   Пароль хранится в `sys_data.password`
-   Ввод пароля — через экранную клавиатуру (функция `numberKeyboard()`)

### Мастер-пароли для входа без ограничения:

-    `"854451"` — вход в режим настроек

-    `"579355"` — вход без пароля

-   Функция проверки пароля — `checkUser(skip)`

## Графический интерфейс

-    Класс `button` — для создания и отображения кнопок, обработки касаний

-    Главное меню (`mainApp`) — набор цветных кнопок для запуска приложений

###    Приложения запускаются по нажатию кнопок с callback-функциями:

-    `paint()` — рисовалка

-    `meteo()` — просмотр метеоданных

-    `settings()` — настройки системы

-    `infobar()` — информационная панель

-    `touchtest()` — тест сенсорного экрана

## Основные приложения
### Рисовалка (paint)

-    Рисование свободной кистью по экрану

-    Палитра цветов для выбора

-    Кнопки очистки и выхода

-    Реализация: прорисовка цветных точек по касанию

### Метео (meteo)

-    Отображение данных с датчиков: освещённость, влажность почвы, температура, влажность воздуха

-    Текущее время с DS1302

-    Кнопка возврата в меню

### Настройки (settings)

-    Установка поворота экрана (0..3)

-    Включение/отключение пароля

-    Установка нового пароля

-    Сброс пароля

-    Сохранение параметров в EEPROM

## Вспомогательные функции

-    `yesno(String text)` — диалог с вопросом и кнопками Да/Нет

-    `osmenu()` — системное меню (блокировка, перезагрузка, выход)

-    `saveParams()` — сохранение настроек в EEPROM

-    `touchtest()` — отображение координат касания, проверка сенсора

## EEPROM Layout

|Адрес|	Описание|
|:-:|:-:|
|0|	Ключ (ByteKey = 12)|
|1..N|	Структура настроек sys_data|

## Возможности расширения

-    Добавление новых приложений (калькулятор, терминал, игры)

-    Расширенное управление сенсорным экраном

-    Усиление безопасности паролей

-    Поддержка беспроводных интерфейсов (Bluetooth, Wi-Fi)

-    Настройка тем оформления и интерфейсов

## Пример использования

1.    При включении загружаются настройки из EEPROM.

2.    Пользователь видит главное меню с кнопками.

3.    Запускает, например, рисовалку или просмотр метеоданных.

4.    В настройках меняет поворот экрана и задаёт пароль.

5.    Пароль защищает доступ при следующем включении.

## Фрагменты кода
**Инициализация системы**
```c++
void initSystem() {
  tft.begin(ID);
  tft.setRotation(sys_data.rotate);
  tft.fillScreen(BLACK);
  tft.setFont(&TimesNRCyr10);
  loadParams();
}
```
**Сохранение параметров**
```c++
void saveParams() {
  EEPROM.write(0, ByteKey);
  EEPROM.put(1, sys_data);
  EEPROM.commit();
}
```
**Проверка пароля**
```c++
bool checkUser(bool skip) {
  if (skip) return true;
  // логика ввода и проверки пароля
}
```
